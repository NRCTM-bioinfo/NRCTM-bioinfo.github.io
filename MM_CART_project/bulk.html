<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Bulk | CAR-T therapy for multiple myeloma</title>
  <meta name="description" content="This is the tutorial of MM CAR-T project." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Bulk | CAR-T therapy for multiple myeloma" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://nrctm-bioinfo.github.io/MM_CART_project/index.html/figure/cover.jpg" />
  <meta property="og:description" content="This is the tutorial of MM CAR-T project." />
  <meta name="github-repo" content="NRCTM-bioinfo/MM-CAR-T-project" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Bulk | CAR-T therapy for multiple myeloma" />
  
  <meta name="twitter:description" content="This is the tutorial of MM CAR-T project." />
  <meta name="twitter:image" content="https://nrctm-bioinfo.github.io/MM_CART_project/index.html/figure/cover.jpg" />

<meta name="author" content="Yu-Ting Dai, Shuangshuang Yang" />


<meta name="date" content="2023-09-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cytokine-profiles.html"/>
<link rel="next" href="scrna-seq.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/NRCTM-bioinfo/MM-CAR-T"><center><b>MM-CAR-T</b></center></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="cytokine-profiles.html"><a href="cytokine-profiles.html"><i class="fa fa-check"></i><b>2</b> Cytokine profiles</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cytokine-profiles.html"><a href="cytokine-profiles.html#load-packages"><i class="fa fa-check"></i><b>2.1</b> Load packages</a></li>
<li class="chapter" data-level="2.2" data-path="cytokine-profiles.html"><a href="cytokine-profiles.html#data-preprocessing"><i class="fa fa-check"></i><b>2.2</b> Data preprocessing</a></li>
<li class="chapter" data-level="2.3" data-path="cytokine-profiles.html"><a href="cytokine-profiles.html#visualization"><i class="fa fa-check"></i><b>2.3</b> Visualization</a></li>
<li class="chapter" data-level="2.4" data-path="cytokine-profiles.html"><a href="cytokine-profiles.html#correlation"><i class="fa fa-check"></i><b>2.4</b> Correlation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bulk.html"><a href="bulk.html"><i class="fa fa-check"></i><b>3</b> Bulk</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bulk.html"><a href="bulk.html#pre-processing"><i class="fa fa-check"></i><b>3.1</b> Pre-processing</a></li>
<li class="chapter" data-level="3.2" data-path="bulk.html"><a href="bulk.html#degs-using-deseq2"><i class="fa fa-check"></i><b>3.2</b> DEGs using DESeq2</a></li>
<li class="chapter" data-level="3.3" data-path="bulk.html"><a href="bulk.html#degs-using-limma"><i class="fa fa-check"></i><b>3.3</b> DEGs using Limma</a></li>
<li class="chapter" data-level="3.4" data-path="bulk.html"><a href="bulk.html#degs-using-edger"><i class="fa fa-check"></i><b>3.4</b> DEGs using edgeR</a></li>
<li class="chapter" data-level="3.5" data-path="bulk.html"><a href="bulk.html#mfuzz"><i class="fa fa-check"></i><b>3.5</b> Mfuzz</a></li>
<li class="chapter" data-level="3.6" data-path="bulk.html"><a href="bulk.html#gsea"><i class="fa fa-check"></i><b>3.6</b> GSEA</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="scrna-seq.html"><a href="scrna-seq.html"><i class="fa fa-check"></i><b>4</b> scRNA-seq</a>
<ul>
<li class="chapter" data-level="4.1" data-path="scrna-seq.html"><a href="scrna-seq.html#pre-processing-1"><i class="fa fa-check"></i><b>4.1</b> Pre-processing</a></li>
<li class="chapter" data-level="4.2" data-path="scrna-seq.html"><a href="scrna-seq.html#quaility-control"><i class="fa fa-check"></i><b>4.2</b> Quaility control</a></li>
<li class="chapter" data-level="4.3" data-path="scrna-seq.html"><a href="scrna-seq.html#annotation"><i class="fa fa-check"></i><b>4.3</b> Annotation</a></li>
<li class="chapter" data-level="4.4" data-path="scrna-seq.html"><a href="scrna-seq.html#markers"><i class="fa fa-check"></i><b>4.4</b> Markers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="about-this-project.html"><a href="about-this-project.html"><i class="fa fa-check"></i><b>5</b> About this project</a>
<ul>
<li class="chapter" data-level="" data-path="about-this-project.html"><a href="about-this-project.html#current-version"><i class="fa fa-check"></i>Current version</a></li>
<li class="chapter" data-level="" data-path="about-this-project.html"><a href="about-this-project.html#session-information"><i class="fa fa-check"></i>Session Information</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CAR-T therapy for multiple myeloma</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bulk" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Bulk<a href="bulk.html#bulk" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="pre-processing" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Pre-processing<a href="bulk.html#pre-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In bulk RNA-seq analysis, Salmon was used to generate the count and transcripts per kilobase of exon model per million mapped reads (TPM) matrix. The DESeq2, limma, and edgeR packages were used to calculate differentially expressed genes (DEGs) with significance level setting as P-value &lt; 0.05.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="bulk.html#cb9-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb9-2"><a href="bulk.html#cb9-2" tabindex="-1"></a><span class="co">#SBATCH -p CPU # partition (queue)</span></span>
<span id="cb9-3"><a href="bulk.html#cb9-3" tabindex="-1"></a><span class="co">#SBATCH --job-name=CART</span></span>
<span id="cb9-4"><a href="bulk.html#cb9-4" tabindex="-1"></a><span class="co">#SBATCH -n 8</span></span>
<span id="cb9-5"><a href="bulk.html#cb9-5" tabindex="-1"></a><span class="co">#SBATCH --array=1-50</span></span>
<span id="cb9-6"><a href="bulk.html#cb9-6" tabindex="-1"></a><span class="co">#SBATCH -t 7-00:00 # time (D-HH:MM)</span></span>
<span id="cb9-7"><a href="bulk.html#cb9-7" tabindex="-1"></a><span class="co">#SBATCH -o _log/mm.%N.%A_%a.out # STDOUT</span></span>
<span id="cb9-8"><a href="bulk.html#cb9-8" tabindex="-1"></a><span class="co">#SBATCH -e _log/mm.%N.%A_%a.err # STDERR</span></span>
<span id="cb9-9"><a href="bulk.html#cb9-9" tabindex="-1"></a><span class="co">#SBATCH --mail-type=</span><span class="re">END</span><span class="co">,FAIL # notifications for job done &amp; fail</span></span>
<span id="cb9-10"><a href="bulk.html#cb9-10" tabindex="-1"></a><span class="co">#SBATCH --mail-user=XX # send-to address</span></span>
<span id="cb9-11"><a href="bulk.html#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="bulk.html#cb9-12" tabindex="-1"></a>id<span class="ot">=</span><span class="st">`</span><span class="at">sed -n ${SLURM_ARRAY_TASK_ID}p ../cart.sample.txt</span><span class="st">`</span></span>
<span id="cb9-13"><a href="bulk.html#cb9-13" tabindex="-1"></a>echo <span class="st">&quot;${id}&quot;</span></span>
<span id="cb9-14"><a href="bulk.html#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="bulk.html#cb9-15" tabindex="-1"></a>fq_path<span class="ot">=</span><span class="er">$</span>{fq_path}</span>
<span id="cb9-16"><a href="bulk.html#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="bulk.html#cb9-17" tabindex="-1"></a>fq1<span class="ot">=</span><span class="er">$</span>{fq_path}<span class="sc">/</span><span class="er">$</span>{id}_R1.fq.gz</span>
<span id="cb9-18"><a href="bulk.html#cb9-18" tabindex="-1"></a>fq2<span class="ot">=</span><span class="er">$</span>{fq_path}<span class="sc">/</span><span class="er">$</span>{id}_R2.fq.gz</span>
<span id="cb9-19"><a href="bulk.html#cb9-19" tabindex="-1"></a></span>
<span id="cb9-20"><a href="bulk.html#cb9-20" tabindex="-1"></a>gtf_file<span class="ot">=</span><span class="er">$</span>{hg38_ref}<span class="sc">/</span>gencode.v37.annotation.gtf</span>
<span id="cb9-21"><a href="bulk.html#cb9-21" tabindex="-1"></a>out_path<span class="ot">=</span><span class="er">$</span>{hg38_ref}<span class="sc">/</span>salmon</span>
<span id="cb9-22"><a href="bulk.html#cb9-22" tabindex="-1"></a>salmon_index<span class="ot">=</span><span class="er">$</span>{hg38_ref}<span class="sc">/</span>gencode.v37.almon</span>
<span id="cb9-23"><a href="bulk.html#cb9-23" tabindex="-1"></a></span>
<span id="cb9-24"><a href="bulk.html#cb9-24" tabindex="-1"></a><span class="sc">$</span>SALMON_1_3 quant <span class="sc">-</span>p <span class="dv">40</span> <span class="sc">-</span>l IU <span class="sc">-</span>i <span class="sc">$</span>{salmon_index} <span class="sc">-</span>o <span class="sc">$</span>{out_path}<span class="sc">/</span><span class="er">$</span>{id} <span class="sc">-</span><span class="dv">1</span> <span class="sc">$</span>{fq1} <span class="sc">-</span><span class="dv">2</span> <span class="sc">$</span>{fq2} <span class="sc">-</span>g <span class="sc">$</span>{gtf_file} <span class="sc">--</span>gcBias <span class="sc">--</span>validateMappings</span></code></pre></div>
<p>Then the TPM and count matrices were generated.</p>
</div>
<div id="degs-using-deseq2" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> DEGs using DESeq2<a href="bulk.html#degs-using-deseq2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="bulk.html#cb10-1" tabindex="-1"></a>exp <span class="ot">&lt;-</span> filter_count51</span>
<span id="cb10-2"><a href="bulk.html#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="bulk.html#cb10-3" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb10-4"><a href="bulk.html#cb10-4" tabindex="-1"></a>compare_t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">10</span>)</span>
<span id="cb10-5"><a href="bulk.html#cb10-5" tabindex="-1"></a>pd1_com_t <span class="ot">&lt;-</span> pd1[pd1<span class="sc">$</span>group1 <span class="sc">%in%</span> compare_t,]</span>
<span id="cb10-6"><a href="bulk.html#cb10-6" tabindex="-1"></a>exp_com_t <span class="ot">&lt;-</span> exp[,<span class="fu">match</span>(pd1_com_t<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp))]</span>
<span id="cb10-7"><a href="bulk.html#cb10-7" tabindex="-1"></a>Group_t <span class="ot">&lt;-</span> <span class="fu">factor</span>(pd1_com_t<span class="sc">$</span>group1,</span>
<span id="cb10-8"><a href="bulk.html#cb10-8" tabindex="-1"></a>                  <span class="at">levels =</span> compare_t) </span>
<span id="cb10-9"><a href="bulk.html#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="bulk.html#cb10-10" tabindex="-1"></a>colData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">row.names =</span><span class="fu">colnames</span>(exp_com_t), </span>
<span id="cb10-11"><a href="bulk.html#cb10-11" tabindex="-1"></a>                      <span class="at">condition=</span>Group_t)</span>
<span id="cb10-12"><a href="bulk.html#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="bulk.html#cb10-13" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(</span>
<span id="cb10-14"><a href="bulk.html#cb10-14" tabindex="-1"></a>  <span class="at">countData =</span> exp_com_t,</span>
<span id="cb10-15"><a href="bulk.html#cb10-15" tabindex="-1"></a>  <span class="at">colData =</span> colData,</span>
<span id="cb10-16"><a href="bulk.html#cb10-16" tabindex="-1"></a>  <span class="at">design =</span> <span class="sc">~</span> condition) </span>
<span id="cb10-17"><a href="bulk.html#cb10-17" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds)</span>
<span id="cb10-18"><a href="bulk.html#cb10-18" tabindex="-1"></a></span>
<span id="cb10-19"><a href="bulk.html#cb10-19" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">results</span>(dds, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">&quot;condition&quot;</span>,<span class="fu">rev</span>(<span class="fu">levels</span>(Group_t))))</span>
<span id="cb10-20"><a href="bulk.html#cb10-20" tabindex="-1"></a>resOrdered <span class="ot">&lt;-</span> res[<span class="fu">order</span>(res<span class="sc">$</span>pvalue),] </span>
<span id="cb10-21"><a href="bulk.html#cb10-21" tabindex="-1"></a>DEG_t <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resOrdered)</span>
<span id="cb10-22"><a href="bulk.html#cb10-22" tabindex="-1"></a><span class="fu">head</span>(DEG_t)</span>
<span id="cb10-23"><a href="bulk.html#cb10-23" tabindex="-1"></a></span>
<span id="cb10-24"><a href="bulk.html#cb10-24" tabindex="-1"></a></span>
<span id="cb10-25"><a href="bulk.html#cb10-25" tabindex="-1"></a><span class="co"># calculation</span></span>
<span id="cb10-26"><a href="bulk.html#cb10-26" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">unique</span>(pd1<span class="sc">$</span>group1)[<span class="fu">order</span>(<span class="fu">unique</span>(pd1<span class="sc">$</span>group1))]<span class="co">#由小到大排序</span></span>
<span id="cb10-27"><a href="bulk.html#cb10-27" tabindex="-1"></a>deg <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb10-28"><a href="bulk.html#cb10-28" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-29"><a href="bulk.html#cb10-29" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(id)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb10-30"><a href="bulk.html#cb10-30" tabindex="-1"></a>  <span class="cf">for</span>(is <span class="cf">in</span> ((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(id))){</span>
<span id="cb10-31"><a href="bulk.html#cb10-31" tabindex="-1"></a>    comp <span class="ot">&lt;-</span> id[<span class="fu">c</span>(i,is)]</span>
<span id="cb10-32"><a href="bulk.html#cb10-32" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb10-33"><a href="bulk.html#cb10-33" tabindex="-1"></a>    pd1_com <span class="ot">&lt;-</span> pd1[pd1<span class="sc">$</span>group1 <span class="sc">%in%</span> comp,]</span>
<span id="cb10-34"><a href="bulk.html#cb10-34" tabindex="-1"></a>    exp_com <span class="ot">&lt;-</span> exp[,<span class="fu">match</span>(pd1_com<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp))] </span>
<span id="cb10-35"><a href="bulk.html#cb10-35" tabindex="-1"></a>    Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(pd1_com<span class="sc">$</span>group1,</span>
<span id="cb10-36"><a href="bulk.html#cb10-36" tabindex="-1"></a>                    <span class="at">levels =</span> comp)</span>
<span id="cb10-37"><a href="bulk.html#cb10-37" tabindex="-1"></a></span>
<span id="cb10-38"><a href="bulk.html#cb10-38" tabindex="-1"></a>    colData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">row.names =</span><span class="fu">colnames</span>(exp_com), </span>
<span id="cb10-39"><a href="bulk.html#cb10-39" tabindex="-1"></a>                          <span class="at">condition=</span>Group)</span>
<span id="cb10-40"><a href="bulk.html#cb10-40" tabindex="-1"></a>    </span>
<span id="cb10-41"><a href="bulk.html#cb10-41" tabindex="-1"></a>    dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(</span>
<span id="cb10-42"><a href="bulk.html#cb10-42" tabindex="-1"></a>      <span class="at">countData =</span> exp_com,</span>
<span id="cb10-43"><a href="bulk.html#cb10-43" tabindex="-1"></a>      <span class="at">colData =</span> colData, </span>
<span id="cb10-44"><a href="bulk.html#cb10-44" tabindex="-1"></a>      <span class="at">design =</span> <span class="sc">~</span> condition) </span>
<span id="cb10-45"><a href="bulk.html#cb10-45" tabindex="-1"></a>    dds <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds)</span>
<span id="cb10-46"><a href="bulk.html#cb10-46" tabindex="-1"></a></span>
<span id="cb10-47"><a href="bulk.html#cb10-47" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">results</span>(dds, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">&quot;condition&quot;</span>,<span class="fu">rev</span>(<span class="fu">levels</span>(Group))))</span>
<span id="cb10-48"><a href="bulk.html#cb10-48" tabindex="-1"></a>    resOrdered <span class="ot">&lt;-</span> res[<span class="fu">order</span>(res<span class="sc">$</span>pvalue),]</span>
<span id="cb10-49"><a href="bulk.html#cb10-49" tabindex="-1"></a>    deg[[n]] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resOrdered)</span>
<span id="cb10-50"><a href="bulk.html#cb10-50" tabindex="-1"></a>    <span class="fu">names</span>(deg)[[n]] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(comp[<span class="dv">1</span>],<span class="st">&quot;Vs&quot;</span>,comp[<span class="dv">2</span>])</span>
<span id="cb10-51"><a href="bulk.html#cb10-51" tabindex="-1"></a>    </span>
<span id="cb10-52"><a href="bulk.html#cb10-52" tabindex="-1"></a>  }</span>
<span id="cb10-53"><a href="bulk.html#cb10-53" tabindex="-1"></a>}</span>
<span id="cb10-54"><a href="bulk.html#cb10-54" tabindex="-1"></a></span>
<span id="cb10-55"><a href="bulk.html#cb10-55" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb10-56"><a href="bulk.html#cb10-56" tabindex="-1"></a>clus <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-57"><a href="bulk.html#cb10-57" tabindex="-1"></a>gene_id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(exp)</span>
<span id="cb10-58"><a href="bulk.html#cb10-58" tabindex="-1"></a></span>
<span id="cb10-59"><a href="bulk.html#cb10-59" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(deg)){</span>
<span id="cb10-60"><a href="bulk.html#cb10-60" tabindex="-1"></a>  te <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Symbol=</span><span class="fu">rownames</span>(deg[[i]]),<span class="at">adj.P.Val=</span>deg[[i]]<span class="sc">$</span>padj)</span>
<span id="cb10-61"><a href="bulk.html#cb10-61" tabindex="-1"></a>  <span class="fu">colnames</span>(te)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">names</span>(deg)[[i]]</span>
<span id="cb10-62"><a href="bulk.html#cb10-62" tabindex="-1"></a>  clus[[i]] <span class="ot">&lt;-</span> te[<span class="fu">match</span>(gene_id,te[,<span class="dv">1</span>]),]</span>
<span id="cb10-63"><a href="bulk.html#cb10-63" tabindex="-1"></a>  <span class="fu">names</span>(clus)[[i]] <span class="ot">&lt;-</span> <span class="fu">names</span>(deg)[[i]]</span>
<span id="cb10-64"><a href="bulk.html#cb10-64" tabindex="-1"></a>  tr[i] <span class="ot">&lt;-</span> <span class="fu">identical</span>(gene_id,clus[[i]][,<span class="dv">1</span>])</span>
<span id="cb10-65"><a href="bulk.html#cb10-65" tabindex="-1"></a>}</span>
<span id="cb10-66"><a href="bulk.html#cb10-66" tabindex="-1"></a><span class="fu">table</span>(tr)</span>
<span id="cb10-67"><a href="bulk.html#cb10-67" tabindex="-1"></a></span>
<span id="cb10-68"><a href="bulk.html#cb10-68" tabindex="-1"></a>deg_all <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(clus) </span>
<span id="cb10-69"><a href="bulk.html#cb10-69" tabindex="-1"></a><span class="fu">rownames</span>(deg_all) <span class="ot">&lt;-</span> gene_id</span>
<span id="cb10-70"><a href="bulk.html#cb10-70" tabindex="-1"></a>deg_all <span class="ot">&lt;-</span> deg_all[,<span class="sc">!</span><span class="fu">str_detect</span>(<span class="fu">colnames</span>(deg_all),<span class="st">&quot;Symbol&quot;</span>)]</span>
<span id="cb10-71"><a href="bulk.html#cb10-71" tabindex="-1"></a></span>
<span id="cb10-72"><a href="bulk.html#cb10-72" tabindex="-1"></a></span>
<span id="cb10-73"><a href="bulk.html#cb10-73" tabindex="-1"></a>pan <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb10-74"><a href="bulk.html#cb10-74" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">rownames</span>(deg_all))){</span>
<span id="cb10-75"><a href="bulk.html#cb10-75" tabindex="-1"></a>  pan[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(deg_all[i,]<span class="sc">&lt;</span><span class="fl">0.05</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb10-76"><a href="bulk.html#cb10-76" tabindex="-1"></a>}</span>
<span id="cb10-77"><a href="bulk.html#cb10-77" tabindex="-1"></a><span class="fu">table</span>(pan)</span>
<span id="cb10-78"><a href="bulk.html#cb10-78" tabindex="-1"></a>deg_deseq2_ch <span class="ot">&lt;-</span> deg_all[pan,]</span></code></pre></div>
</div>
<div id="degs-using-limma" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> DEGs using Limma<a href="bulk.html#degs-using-limma" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="bulk.html#cb11-1" tabindex="-1"></a>exp <span class="ot">&lt;-</span> filter_count51</span>
<span id="cb11-2"><a href="bulk.html#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="bulk.html#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="bulk.html#cb11-4" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb11-5"><a href="bulk.html#cb11-5" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">10</span>)</span>
<span id="cb11-6"><a href="bulk.html#cb11-6" tabindex="-1"></a>pd1_com <span class="ot">&lt;-</span> pd1[pd1<span class="sc">$</span>group1 <span class="sc">%in%</span> comp,]</span>
<span id="cb11-7"><a href="bulk.html#cb11-7" tabindex="-1"></a>exp_com <span class="ot">&lt;-</span> exp[,<span class="fu">match</span>(pd1_com<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp))] </span>
<span id="cb11-8"><a href="bulk.html#cb11-8" tabindex="-1"></a><span class="fu">identical</span>(pd1_com<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp_com))</span>
<span id="cb11-9"><a href="bulk.html#cb11-9" tabindex="-1"></a>Group_t <span class="ot">&lt;-</span> <span class="fu">factor</span>(pd1_com<span class="sc">$</span>group1,</span>
<span id="cb11-10"><a href="bulk.html#cb11-10" tabindex="-1"></a>                  <span class="at">levels =</span>comp) </span>
<span id="cb11-11"><a href="bulk.html#cb11-11" tabindex="-1"></a>Group_t </span>
<span id="cb11-12"><a href="bulk.html#cb11-12" tabindex="-1"></a>Group_ts <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pd1_com<span class="sc">$</span>group1<span class="sc">==</span>comp[<span class="dv">1</span>],<span class="st">&quot;control&quot;</span>,<span class="st">&quot;treat&quot;</span>)</span>
<span id="cb11-13"><a href="bulk.html#cb11-13" tabindex="-1"></a>Group_ts <span class="ot">&lt;-</span> <span class="fu">factor</span>(Group_ts,</span>
<span id="cb11-14"><a href="bulk.html#cb11-14" tabindex="-1"></a>                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;control&quot;</span>,<span class="st">&quot;treat&quot;</span>))</span>
<span id="cb11-15"><a href="bulk.html#cb11-15" tabindex="-1"></a>Group_ts </span>
<span id="cb11-16"><a href="bulk.html#cb11-16" tabindex="-1"></a></span>
<span id="cb11-17"><a href="bulk.html#cb11-17" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>Group_ts)</span>
<span id="cb11-18"><a href="bulk.html#cb11-18" tabindex="-1"></a><span class="fu">colnames</span>(design)<span class="ot">=</span><span class="fu">levels</span>(Group_ts)</span>
<span id="cb11-19"><a href="bulk.html#cb11-19" tabindex="-1"></a><span class="fu">rownames</span>(design)<span class="ot">=</span><span class="fu">colnames</span>(exp_com)</span>
<span id="cb11-20"><a href="bulk.html#cb11-20" tabindex="-1"></a><span class="fu">library</span>(edgeR)</span>
<span id="cb11-21"><a href="bulk.html#cb11-21" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">DGEList</span>(<span class="at">counts=</span>exp_com)</span>
<span id="cb11-22"><a href="bulk.html#cb11-22" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">calcNormFactors</span>(dge)</span>
<span id="cb11-23"><a href="bulk.html#cb11-23" tabindex="-1"></a></span>
<span id="cb11-24"><a href="bulk.html#cb11-24" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">voom</span>(dge,design, <span class="at">normalize=</span><span class="st">&quot;quantile&quot;</span>)</span>
<span id="cb11-25"><a href="bulk.html#cb11-25" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, design)</span>
<span id="cb11-26"><a href="bulk.html#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="bulk.html#cb11-27" tabindex="-1"></a>constrasts <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">rev</span>(<span class="fu">levels</span>(Group_ts)),<span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb11-28"><a href="bulk.html#cb11-28" tabindex="-1"></a>cont.matrix <span class="ot">&lt;-</span> <span class="fu">makeContrasts</span>(<span class="at">contrasts=</span>constrasts,<span class="at">levels =</span> design) </span>
<span id="cb11-29"><a href="bulk.html#cb11-29" tabindex="-1"></a>fit2<span class="ot">=</span><span class="fu">contrasts.fit</span>(fit,cont.matrix)</span>
<span id="cb11-30"><a href="bulk.html#cb11-30" tabindex="-1"></a>fit2<span class="ot">=</span><span class="fu">eBayes</span>(fit2)</span>
<span id="cb11-31"><a href="bulk.html#cb11-31" tabindex="-1"></a></span>
<span id="cb11-32"><a href="bulk.html#cb11-32" tabindex="-1"></a>deg_t<span class="ot">=</span> <span class="fu">topTable</span>(fit2, <span class="at">coef=</span>constrasts, <span class="at">n=</span><span class="cn">Inf</span>)</span>
<span id="cb11-33"><a href="bulk.html#cb11-33" tabindex="-1"></a></span>
<span id="cb11-34"><a href="bulk.html#cb11-34" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(filter_fpkm51[<span class="fu">rownames</span>(filter_fpkm51)<span class="sc">==</span><span class="st">&quot;CHI3L2&quot;</span>,pd1_com<span class="sc">$</span>ID]))</span>
<span id="cb11-35"><a href="bulk.html#cb11-35" tabindex="-1"></a>test<span class="sc">$</span>Group_t <span class="ot">&lt;-</span> Group_t</span>
<span id="cb11-36"><a href="bulk.html#cb11-36" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-37"><a href="bulk.html#cb11-37" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> test,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>Group_t,<span class="at">y=</span>CHI3L2))<span class="sc">+</span></span>
<span id="cb11-38"><a href="bulk.html#cb11-38" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb11-39"><a href="bulk.html#cb11-39" tabindex="-1"></a></span>
<span id="cb11-40"><a href="bulk.html#cb11-40" tabindex="-1"></a></span>
<span id="cb11-41"><a href="bulk.html#cb11-41" tabindex="-1"></a><span class="do">### calculation</span></span>
<span id="cb11-42"><a href="bulk.html#cb11-42" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">unique</span>(pd1<span class="sc">$</span>group1)[<span class="fu">order</span>(<span class="fu">unique</span>(pd1<span class="sc">$</span>group1))]</span>
<span id="cb11-43"><a href="bulk.html#cb11-43" tabindex="-1"></a>id</span>
<span id="cb11-44"><a href="bulk.html#cb11-44" tabindex="-1"></a>deg <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb11-45"><a href="bulk.html#cb11-45" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-46"><a href="bulk.html#cb11-46" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(id)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb11-47"><a href="bulk.html#cb11-47" tabindex="-1"></a>  <span class="cf">for</span>(is <span class="cf">in</span> ((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(id))){</span>
<span id="cb11-48"><a href="bulk.html#cb11-48" tabindex="-1"></a>    comp <span class="ot">&lt;-</span> id[<span class="fu">c</span>(i,is)]</span>
<span id="cb11-49"><a href="bulk.html#cb11-49" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb11-50"><a href="bulk.html#cb11-50" tabindex="-1"></a>    </span>
<span id="cb11-51"><a href="bulk.html#cb11-51" tabindex="-1"></a>    pd1_com <span class="ot">&lt;-</span> pd1[pd1<span class="sc">$</span>group1 <span class="sc">%in%</span> comp,]</span>
<span id="cb11-52"><a href="bulk.html#cb11-52" tabindex="-1"></a>    exp_com <span class="ot">&lt;-</span> exp[,<span class="fu">match</span>(pd1_com<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp))] </span>
<span id="cb11-53"><a href="bulk.html#cb11-53" tabindex="-1"></a>    <span class="fu">identical</span>(pd1_com<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp_com))</span>
<span id="cb11-54"><a href="bulk.html#cb11-54" tabindex="-1"></a>    </span>
<span id="cb11-55"><a href="bulk.html#cb11-55" tabindex="-1"></a>    Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(pd1_com<span class="sc">$</span>group1,</span>
<span id="cb11-56"><a href="bulk.html#cb11-56" tabindex="-1"></a>                    <span class="at">levels =</span>comp)</span>
<span id="cb11-57"><a href="bulk.html#cb11-57" tabindex="-1"></a>    Group </span>
<span id="cb11-58"><a href="bulk.html#cb11-58" tabindex="-1"></a>    </span>
<span id="cb11-59"><a href="bulk.html#cb11-59" tabindex="-1"></a>    Group_s <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pd1_com<span class="sc">$</span>group1<span class="sc">==</span>comp[<span class="dv">1</span>],<span class="st">&quot;control&quot;</span>,<span class="st">&quot;treat&quot;</span>)</span>
<span id="cb11-60"><a href="bulk.html#cb11-60" tabindex="-1"></a>    Group_s <span class="ot">&lt;-</span> <span class="fu">factor</span>(Group_s,</span>
<span id="cb11-61"><a href="bulk.html#cb11-61" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;control&quot;</span>,<span class="st">&quot;treat&quot;</span>))</span>
<span id="cb11-62"><a href="bulk.html#cb11-62" tabindex="-1"></a>    Group_s </span>
<span id="cb11-63"><a href="bulk.html#cb11-63" tabindex="-1"></a></span>
<span id="cb11-64"><a href="bulk.html#cb11-64" tabindex="-1"></a>    design <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>Group_s)</span>
<span id="cb11-65"><a href="bulk.html#cb11-65" tabindex="-1"></a>    <span class="fu">colnames</span>(design)<span class="ot">=</span><span class="fu">levels</span>(Group_s)</span>
<span id="cb11-66"><a href="bulk.html#cb11-66" tabindex="-1"></a>    <span class="fu">rownames</span>(design)<span class="ot">=</span><span class="fu">colnames</span>(exp_com)</span>
<span id="cb11-67"><a href="bulk.html#cb11-67" tabindex="-1"></a>    <span class="fu">library</span>(edgeR)</span>
<span id="cb11-68"><a href="bulk.html#cb11-68" tabindex="-1"></a>    dge <span class="ot">&lt;-</span> <span class="fu">DGEList</span>(<span class="at">counts=</span>exp_com)</span>
<span id="cb11-69"><a href="bulk.html#cb11-69" tabindex="-1"></a>    dge <span class="ot">&lt;-</span> <span class="fu">calcNormFactors</span>(dge)</span>
<span id="cb11-70"><a href="bulk.html#cb11-70" tabindex="-1"></a>    </span>
<span id="cb11-71"><a href="bulk.html#cb11-71" tabindex="-1"></a>    v <span class="ot">&lt;-</span> <span class="fu">voom</span>(dge,design, <span class="at">normalize=</span><span class="st">&quot;quantile&quot;</span>) </span>
<span id="cb11-72"><a href="bulk.html#cb11-72" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">lmFit</span>(v, design)</span>
<span id="cb11-73"><a href="bulk.html#cb11-73" tabindex="-1"></a>    </span>
<span id="cb11-74"><a href="bulk.html#cb11-74" tabindex="-1"></a>    constrasts <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">rev</span>(<span class="fu">levels</span>(Group_s)),<span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb11-75"><a href="bulk.html#cb11-75" tabindex="-1"></a>    cont.matrix <span class="ot">&lt;-</span> <span class="fu">makeContrasts</span>(<span class="at">contrasts=</span>constrasts,<span class="at">levels =</span> design) </span>
<span id="cb11-76"><a href="bulk.html#cb11-76" tabindex="-1"></a>    fit2<span class="ot">=</span><span class="fu">contrasts.fit</span>(fit,cont.matrix)</span>
<span id="cb11-77"><a href="bulk.html#cb11-77" tabindex="-1"></a>    fit2<span class="ot">=</span><span class="fu">eBayes</span>(fit2)</span>
<span id="cb11-78"><a href="bulk.html#cb11-78" tabindex="-1"></a>    </span>
<span id="cb11-79"><a href="bulk.html#cb11-79" tabindex="-1"></a>    deg[[n]]<span class="ot">=</span> <span class="fu">topTable</span>(fit2, <span class="at">coef=</span>constrasts, <span class="at">n=</span><span class="cn">Inf</span>)</span>
<span id="cb11-80"><a href="bulk.html#cb11-80" tabindex="-1"></a>    </span>
<span id="cb11-81"><a href="bulk.html#cb11-81" tabindex="-1"></a>    <span class="fu">names</span>(deg)[[n]] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(comp[<span class="dv">1</span>],<span class="st">&quot;Vs&quot;</span>,comp[<span class="dv">2</span>])</span>
<span id="cb11-82"><a href="bulk.html#cb11-82" tabindex="-1"></a>  }</span>
<span id="cb11-83"><a href="bulk.html#cb11-83" tabindex="-1"></a>}</span>
<span id="cb11-84"><a href="bulk.html#cb11-84" tabindex="-1"></a></span>
<span id="cb11-85"><a href="bulk.html#cb11-85" tabindex="-1"></a><span class="fu">rownames</span>(exp)</span>
<span id="cb11-86"><a href="bulk.html#cb11-86" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb11-87"><a href="bulk.html#cb11-87" tabindex="-1"></a>clus <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-88"><a href="bulk.html#cb11-88" tabindex="-1"></a>gene_id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(exp)</span>
<span id="cb11-89"><a href="bulk.html#cb11-89" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(deg)){</span>
<span id="cb11-90"><a href="bulk.html#cb11-90" tabindex="-1"></a>  te <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Symbol=</span><span class="fu">rownames</span>(deg[[i]]),<span class="at">adj.P.Val=</span>deg[[i]]<span class="sc">$</span>adj.P.Val)<span class="co">#te作为中介</span></span>
<span id="cb11-91"><a href="bulk.html#cb11-91" tabindex="-1"></a>  <span class="fu">colnames</span>(te)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">names</span>(deg)[[i]]</span>
<span id="cb11-92"><a href="bulk.html#cb11-92" tabindex="-1"></a>  clus[[i]] <span class="ot">&lt;-</span> te[<span class="fu">match</span>(gene_id,te[,<span class="dv">1</span>]),]</span>
<span id="cb11-93"><a href="bulk.html#cb11-93" tabindex="-1"></a>  <span class="fu">names</span>(clus)[[i]] <span class="ot">&lt;-</span> <span class="fu">names</span>(deg)[[i]]</span>
<span id="cb11-94"><a href="bulk.html#cb11-94" tabindex="-1"></a>  tr[i] <span class="ot">&lt;-</span> <span class="fu">identical</span>(gene_id,clus[[i]][,<span class="dv">1</span>])</span>
<span id="cb11-95"><a href="bulk.html#cb11-95" tabindex="-1"></a>}</span>
<span id="cb11-96"><a href="bulk.html#cb11-96" tabindex="-1"></a><span class="fu">table</span>(tr)</span>
<span id="cb11-97"><a href="bulk.html#cb11-97" tabindex="-1"></a>deg_all <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(clus) </span>
<span id="cb11-98"><a href="bulk.html#cb11-98" tabindex="-1"></a><span class="fu">rownames</span>(deg_all) <span class="ot">&lt;-</span> gene_id</span>
<span id="cb11-99"><a href="bulk.html#cb11-99" tabindex="-1"></a>deg_all <span class="ot">&lt;-</span> deg_all[,<span class="sc">!</span><span class="fu">str_detect</span>(<span class="fu">colnames</span>(deg_all),<span class="st">&quot;Symbol&quot;</span>)]</span>
<span id="cb11-100"><a href="bulk.html#cb11-100" tabindex="-1"></a></span>
<span id="cb11-101"><a href="bulk.html#cb11-101" tabindex="-1"></a></span>
<span id="cb11-102"><a href="bulk.html#cb11-102" tabindex="-1"></a>pan <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb11-103"><a href="bulk.html#cb11-103" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">rownames</span>(deg_all))){</span>
<span id="cb11-104"><a href="bulk.html#cb11-104" tabindex="-1"></a>  pan[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(deg_all[i,]<span class="sc">&lt;</span><span class="fl">0.05</span>)<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb11-105"><a href="bulk.html#cb11-105" tabindex="-1"></a>}</span>
<span id="cb11-106"><a href="bulk.html#cb11-106" tabindex="-1"></a><span class="fu">table</span>(pan)</span>
<span id="cb11-107"><a href="bulk.html#cb11-107" tabindex="-1"></a>deg_limma_ch <span class="ot">&lt;-</span> deg_all[pan,]</span></code></pre></div>
</div>
<div id="degs-using-edger" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> DEGs using edgeR<a href="bulk.html#degs-using-edger" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="bulk.html#cb12-1" tabindex="-1"></a>exp <span class="ot">&lt;-</span> filter_count51</span>
<span id="cb12-2"><a href="bulk.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="bulk.html#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="bulk.html#cb12-4" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb12-5"><a href="bulk.html#cb12-5" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">10</span>) </span>
<span id="cb12-6"><a href="bulk.html#cb12-6" tabindex="-1"></a>pd1_com <span class="ot">&lt;-</span> pd1[pd1<span class="sc">$</span>group1 <span class="sc">%in%</span> comp,]<span class="co">#得到分组pd</span></span>
<span id="cb12-7"><a href="bulk.html#cb12-7" tabindex="-1"></a>exp_com <span class="ot">&lt;-</span> exp[,<span class="fu">match</span>(pd1_com<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp))] </span>
<span id="cb12-8"><a href="bulk.html#cb12-8" tabindex="-1"></a>Group_t <span class="ot">&lt;-</span> <span class="fu">factor</span>(pd1_com<span class="sc">$</span>group1,</span>
<span id="cb12-9"><a href="bulk.html#cb12-9" tabindex="-1"></a>                  <span class="at">levels =</span> comp) </span>
<span id="cb12-10"><a href="bulk.html#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="bulk.html#cb12-11" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">DGEList</span>(<span class="at">counts=</span>exp_com,<span class="at">group=</span>Group_t) </span>
<span id="cb12-12"><a href="bulk.html#cb12-12" tabindex="-1"></a>dge<span class="sc">$</span>samples<span class="sc">$</span>lib.size <span class="ot">&lt;-</span> <span class="fu">colSums</span>(dge<span class="sc">$</span>counts)</span>
<span id="cb12-13"><a href="bulk.html#cb12-13" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">calcNormFactors</span>(dge) </span>
<span id="cb12-14"><a href="bulk.html#cb12-14" tabindex="-1"></a></span>
<span id="cb12-15"><a href="bulk.html#cb12-15" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>Group_t)</span>
<span id="cb12-16"><a href="bulk.html#cb12-16" tabindex="-1"></a><span class="fu">rownames</span>(design)<span class="ot">&lt;-</span><span class="fu">colnames</span>(dge)</span>
<span id="cb12-17"><a href="bulk.html#cb12-17" tabindex="-1"></a><span class="fu">colnames</span>(design)<span class="ot">&lt;-</span><span class="fu">levels</span>(Group_t)</span>
<span id="cb12-18"><a href="bulk.html#cb12-18" tabindex="-1"></a></span>
<span id="cb12-19"><a href="bulk.html#cb12-19" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">estimateGLMCommonDisp</span>(dge, design)</span>
<span id="cb12-20"><a href="bulk.html#cb12-20" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">estimateGLMTrendedDisp</span>(dge, design)</span>
<span id="cb12-21"><a href="bulk.html#cb12-21" tabindex="-1"></a>dge <span class="ot">&lt;-</span> <span class="fu">estimateGLMTagwiseDisp</span>(dge, design)</span>
<span id="cb12-22"><a href="bulk.html#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="bulk.html#cb12-23" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmFit</span>(dge, design)</span>
<span id="cb12-24"><a href="bulk.html#cb12-24" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glmLRT</span>(fit, <span class="at">contrast=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)) </span>
<span id="cb12-25"><a href="bulk.html#cb12-25" tabindex="-1"></a></span>
<span id="cb12-26"><a href="bulk.html#cb12-26" tabindex="-1"></a>DEG<span class="ot">=</span><span class="fu">topTags</span>(fit2, <span class="at">n=</span><span class="fu">nrow</span>(exp))</span>
<span id="cb12-27"><a href="bulk.html#cb12-27" tabindex="-1"></a>deg_t<span class="ot">=</span><span class="fu">as.data.frame</span>(DEG) </span>
<span id="cb12-28"><a href="bulk.html#cb12-28" tabindex="-1"></a></span>
<span id="cb12-29"><a href="bulk.html#cb12-29" tabindex="-1"></a></span>
<span id="cb12-30"><a href="bulk.html#cb12-30" tabindex="-1"></a></span>
<span id="cb12-31"><a href="bulk.html#cb12-31" tabindex="-1"></a><span class="co"># calculation</span></span>
<span id="cb12-32"><a href="bulk.html#cb12-32" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">unique</span>(pd1<span class="sc">$</span>group1)[<span class="fu">order</span>(<span class="fu">unique</span>(pd1<span class="sc">$</span>group1))]</span>
<span id="cb12-33"><a href="bulk.html#cb12-33" tabindex="-1"></a>id</span>
<span id="cb12-34"><a href="bulk.html#cb12-34" tabindex="-1"></a>deg <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb12-35"><a href="bulk.html#cb12-35" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-36"><a href="bulk.html#cb12-36" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(id)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb12-37"><a href="bulk.html#cb12-37" tabindex="-1"></a>  <span class="cf">for</span>(is <span class="cf">in</span> ((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(id))){</span>
<span id="cb12-38"><a href="bulk.html#cb12-38" tabindex="-1"></a>    comp <span class="ot">&lt;-</span> id[<span class="fu">c</span>(i,is)]</span>
<span id="cb12-39"><a href="bulk.html#cb12-39" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb12-40"><a href="bulk.html#cb12-40" tabindex="-1"></a>    pd1_com <span class="ot">&lt;-</span> pd1[pd1<span class="sc">$</span>group1 <span class="sc">%in%</span> comp,]</span>
<span id="cb12-41"><a href="bulk.html#cb12-41" tabindex="-1"></a>    exp_com <span class="ot">&lt;-</span> exp[,<span class="fu">match</span>(pd1_com<span class="sc">$</span>ID,<span class="fu">colnames</span>(exp))] </span>
<span id="cb12-42"><a href="bulk.html#cb12-42" tabindex="-1"></a>    Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(pd1_com<span class="sc">$</span>group1,</span>
<span id="cb12-43"><a href="bulk.html#cb12-43" tabindex="-1"></a>                    <span class="at">levels =</span> comp) </span>
<span id="cb12-44"><a href="bulk.html#cb12-44" tabindex="-1"></a>    </span>
<span id="cb12-45"><a href="bulk.html#cb12-45" tabindex="-1"></a>    dge <span class="ot">&lt;-</span> <span class="fu">DGEList</span>(<span class="at">counts=</span>exp_com,<span class="at">group=</span>Group) </span>
<span id="cb12-46"><a href="bulk.html#cb12-46" tabindex="-1"></a>    dge<span class="sc">$</span>samples<span class="sc">$</span>lib.size <span class="ot">&lt;-</span> <span class="fu">colSums</span>(dge<span class="sc">$</span>counts)</span>
<span id="cb12-47"><a href="bulk.html#cb12-47" tabindex="-1"></a>    dge <span class="ot">&lt;-</span> <span class="fu">calcNormFactors</span>(dge) </span>
<span id="cb12-48"><a href="bulk.html#cb12-48" tabindex="-1"></a>    </span>
<span id="cb12-49"><a href="bulk.html#cb12-49" tabindex="-1"></a>    design <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>Group)</span>
<span id="cb12-50"><a href="bulk.html#cb12-50" tabindex="-1"></a>    <span class="fu">rownames</span>(design)<span class="ot">&lt;-</span><span class="fu">colnames</span>(dge)</span>
<span id="cb12-51"><a href="bulk.html#cb12-51" tabindex="-1"></a>    <span class="fu">colnames</span>(design)<span class="ot">&lt;-</span><span class="fu">levels</span>(Group)</span>
<span id="cb12-52"><a href="bulk.html#cb12-52" tabindex="-1"></a>    </span>
<span id="cb12-53"><a href="bulk.html#cb12-53" tabindex="-1"></a>    dge <span class="ot">&lt;-</span> <span class="fu">estimateGLMCommonDisp</span>(dge, design)</span>
<span id="cb12-54"><a href="bulk.html#cb12-54" tabindex="-1"></a>    dge <span class="ot">&lt;-</span> <span class="fu">estimateGLMTrendedDisp</span>(dge, design)</span>
<span id="cb12-55"><a href="bulk.html#cb12-55" tabindex="-1"></a>    dge <span class="ot">&lt;-</span> <span class="fu">estimateGLMTagwiseDisp</span>(dge, design)</span>
<span id="cb12-56"><a href="bulk.html#cb12-56" tabindex="-1"></a>    </span>
<span id="cb12-57"><a href="bulk.html#cb12-57" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">glmFit</span>(dge, design)</span>
<span id="cb12-58"><a href="bulk.html#cb12-58" tabindex="-1"></a>    fit2 <span class="ot">&lt;-</span> <span class="fu">glmLRT</span>(fit, <span class="at">contrast=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)) </span>
<span id="cb12-59"><a href="bulk.html#cb12-59" tabindex="-1"></a>    </span>
<span id="cb12-60"><a href="bulk.html#cb12-60" tabindex="-1"></a>    DEG<span class="ot">=</span><span class="fu">topTags</span>(fit2, <span class="at">n=</span><span class="fu">nrow</span>(exp))</span>
<span id="cb12-61"><a href="bulk.html#cb12-61" tabindex="-1"></a>    deg[[n]]<span class="ot">=</span><span class="fu">as.data.frame</span>(DEG) </span>
<span id="cb12-62"><a href="bulk.html#cb12-62" tabindex="-1"></a>    </span>
<span id="cb12-63"><a href="bulk.html#cb12-63" tabindex="-1"></a>    <span class="fu">names</span>(deg)[[n]] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(comp[<span class="dv">1</span>],<span class="st">&quot;Vs&quot;</span>,comp[<span class="dv">2</span>])</span>
<span id="cb12-64"><a href="bulk.html#cb12-64" tabindex="-1"></a>  }</span>
<span id="cb12-65"><a href="bulk.html#cb12-65" tabindex="-1"></a>}</span>
<span id="cb12-66"><a href="bulk.html#cb12-66" tabindex="-1"></a></span>
<span id="cb12-67"><a href="bulk.html#cb12-67" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb12-68"><a href="bulk.html#cb12-68" tabindex="-1"></a>clus <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb12-69"><a href="bulk.html#cb12-69" tabindex="-1"></a>gene_id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(deg[[<span class="dv">1</span>]])</span>
<span id="cb12-70"><a href="bulk.html#cb12-70" tabindex="-1"></a></span>
<span id="cb12-71"><a href="bulk.html#cb12-71" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(deg)){</span>
<span id="cb12-72"><a href="bulk.html#cb12-72" tabindex="-1"></a>  te <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Symbol=</span><span class="fu">rownames</span>(deg[[i]]),<span class="at">adj.P.Val=</span>deg[[i]]<span class="sc">$</span>FDR)<span class="co">#te作为中介</span></span>
<span id="cb12-73"><a href="bulk.html#cb12-73" tabindex="-1"></a>  <span class="fu">colnames</span>(te)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">names</span>(deg)[[i]]</span>
<span id="cb12-74"><a href="bulk.html#cb12-74" tabindex="-1"></a>  clus[[i]] <span class="ot">&lt;-</span> te[<span class="fu">match</span>(gene_id,te[,<span class="dv">1</span>]),]<span class="co">#以gene_id固定相同的顺序</span></span>
<span id="cb12-75"><a href="bulk.html#cb12-75" tabindex="-1"></a>  <span class="fu">names</span>(clus)[[i]] <span class="ot">&lt;-</span> <span class="fu">names</span>(deg)[[i]]</span>
<span id="cb12-76"><a href="bulk.html#cb12-76" tabindex="-1"></a>  tr[i] <span class="ot">&lt;-</span> <span class="fu">identical</span>(gene_id,clus[[i]][,<span class="dv">1</span>])</span>
<span id="cb12-77"><a href="bulk.html#cb12-77" tabindex="-1"></a>}</span>
<span id="cb12-78"><a href="bulk.html#cb12-78" tabindex="-1"></a><span class="fu">table</span>(tr)</span>
<span id="cb12-79"><a href="bulk.html#cb12-79" tabindex="-1"></a>deg_all <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(clus) </span>
<span id="cb12-80"><a href="bulk.html#cb12-80" tabindex="-1"></a><span class="fu">rownames</span>(deg_all) <span class="ot">&lt;-</span> gene_id</span>
<span id="cb12-81"><a href="bulk.html#cb12-81" tabindex="-1"></a>deg_all <span class="ot">&lt;-</span> deg_all[,<span class="sc">!</span><span class="fu">str_detect</span>(<span class="fu">colnames</span>(deg_all),<span class="st">&quot;Symbol&quot;</span>)]</span>
<span id="cb12-82"><a href="bulk.html#cb12-82" tabindex="-1"></a></span>
<span id="cb12-83"><a href="bulk.html#cb12-83" tabindex="-1"></a>pan <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb12-84"><a href="bulk.html#cb12-84" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">rownames</span>(deg_all))){</span>
<span id="cb12-85"><a href="bulk.html#cb12-85" tabindex="-1"></a>  pan[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(deg_all[i,]<span class="sc">&lt;</span><span class="fl">0.05</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb12-86"><a href="bulk.html#cb12-86" tabindex="-1"></a>}</span>
<span id="cb12-87"><a href="bulk.html#cb12-87" tabindex="-1"></a><span class="fu">table</span>(pan)</span>
<span id="cb12-88"><a href="bulk.html#cb12-88" tabindex="-1"></a>deg_edgeR_ch <span class="ot">&lt;-</span> deg_all[pan,]</span></code></pre></div>
</div>
<div id="mfuzz" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Mfuzz<a href="bulk.html#mfuzz" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="bulk.html#cb13-1" tabindex="-1"></a>limma_sigGene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(deg_limma_ch)</span>
<span id="cb13-2"><a href="bulk.html#cb13-2" tabindex="-1"></a>edgeR_sigGene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(deg_edgeR_ch)</span>
<span id="cb13-3"><a href="bulk.html#cb13-3" tabindex="-1"></a>DESeq2_sigGene <span class="ot">&lt;-</span> <span class="fu">rownames</span>(deg_deseq2_ch)</span>
<span id="cb13-4"><a href="bulk.html#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="bulk.html#cb13-5" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">limma=</span>limma_sigGene,</span>
<span id="cb13-6"><a href="bulk.html#cb13-6" tabindex="-1"></a>             <span class="at">edgeR=</span>edgeR_sigGene,</span>
<span id="cb13-7"><a href="bulk.html#cb13-7" tabindex="-1"></a>             <span class="at">DESeq2=</span>DESeq2_sigGene)</span>
<span id="cb13-8"><a href="bulk.html#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="bulk.html#cb13-9" tabindex="-1"></a><span class="fu">library</span>(VennDiagram)</span>
<span id="cb13-10"><a href="bulk.html#cb13-10" tabindex="-1"></a></span>
<span id="cb13-11"><a href="bulk.html#cb13-11" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;#0099CC&#39;</span>,<span class="st">&#39;#FF6666&#39;</span>,<span class="st">&#39;#FFCC99&#39;</span>)</span>
<span id="cb13-12"><a href="bulk.html#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="bulk.html#cb13-13" tabindex="-1"></a><span class="fu">venn.diagram</span>(data,</span>
<span id="cb13-14"><a href="bulk.html#cb13-14" tabindex="-1"></a>             <span class="at">lwd=</span><span class="dv">1</span>,</span>
<span id="cb13-15"><a href="bulk.html#cb13-15" tabindex="-1"></a>             <span class="at">lty=</span><span class="dv">1</span>,</span>
<span id="cb13-16"><a href="bulk.html#cb13-16" tabindex="-1"></a>             <span class="at">col=</span>col,</span>
<span id="cb13-17"><a href="bulk.html#cb13-17" tabindex="-1"></a>             <span class="at">fill=</span>col,</span>
<span id="cb13-18"><a href="bulk.html#cb13-18" tabindex="-1"></a>             <span class="at">cat.col=</span>col,</span>
<span id="cb13-19"><a href="bulk.html#cb13-19" tabindex="-1"></a>             <span class="at">cat.cex =</span> <span class="fl">1.8</span>,</span>
<span id="cb13-20"><a href="bulk.html#cb13-20" tabindex="-1"></a>             <span class="at">rotation.degree =</span> <span class="dv">0</span>,</span>
<span id="cb13-21"><a href="bulk.html#cb13-21" tabindex="-1"></a>             <span class="at">cex=</span><span class="fl">1.5</span>,</span>
<span id="cb13-22"><a href="bulk.html#cb13-22" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-23"><a href="bulk.html#cb13-23" tabindex="-1"></a>             <span class="at">reverse=</span><span class="cn">TRUE</span>,</span>
<span id="cb13-24"><a href="bulk.html#cb13-24" tabindex="-1"></a>             <span class="at">width=</span><span class="dv">4000</span>,<span class="at">height =</span> <span class="dv">4000</span>,<span class="at">resolution =</span><span class="dv">600</span>,<span class="at">margin=</span><span class="fl">0.2</span>,</span>
<span id="cb13-25"><a href="bulk.html#cb13-25" tabindex="-1"></a>             <span class="at">filename=</span><span class="st">&quot;d21_mfuzz/3DEG_venn.png&quot;</span>,<span class="at">imagetype=</span><span class="st">&quot;png&quot;</span>)</span>
<span id="cb13-26"><a href="bulk.html#cb13-26" tabindex="-1"></a></span>
<span id="cb13-27"><a href="bulk.html#cb13-27" tabindex="-1"></a></span>
<span id="cb13-28"><a href="bulk.html#cb13-28" tabindex="-1"></a>sigGene3 <span class="ot">=</span> <span class="fu">intersect</span>(<span class="fu">intersect</span>(limma_sigGene,</span>
<span id="cb13-29"><a href="bulk.html#cb13-29" tabindex="-1"></a>                               edgeR_sigGene),</span>
<span id="cb13-30"><a href="bulk.html#cb13-30" tabindex="-1"></a>                     DESeq2_sigGene)</span>
<span id="cb13-31"><a href="bulk.html#cb13-31" tabindex="-1"></a></span>
<span id="cb13-32"><a href="bulk.html#cb13-32" tabindex="-1"></a></span>
<span id="cb13-33"><a href="bulk.html#cb13-33" tabindex="-1"></a>eset <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">&quot;ExpressionSet&quot;</span>,<span class="at">exprs =</span> DEGs_exp_averp)</span>
<span id="cb13-34"><a href="bulk.html#cb13-34" tabindex="-1"></a>eset <span class="ot">&lt;-</span> <span class="fu">filter.std</span>(eset,<span class="at">min.std=</span><span class="dv">0</span>) </span>
<span id="cb13-35"><a href="bulk.html#cb13-35" tabindex="-1"></a>eset <span class="ot">&lt;-</span> <span class="fu">standardise</span>(eset)</span>
<span id="cb13-36"><a href="bulk.html#cb13-36" tabindex="-1"></a></span>
<span id="cb13-37"><a href="bulk.html#cb13-37" tabindex="-1"></a>c <span class="ot">&lt;-</span><span class="dv">8</span></span>
<span id="cb13-38"><a href="bulk.html#cb13-38" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">mestimate</span>(eset) </span>
<span id="cb13-39"><a href="bulk.html#cb13-39" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-40"><a href="bulk.html#cb13-40" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">mfuzz</span>(eset, <span class="at">c =</span> c, <span class="at">m =</span> m) </span>
<span id="cb13-41"><a href="bulk.html#cb13-41" tabindex="-1"></a></span>
<span id="cb13-42"><a href="bulk.html#cb13-42" tabindex="-1"></a>cl<span class="sc">$</span>size</span>
<span id="cb13-43"><a href="bulk.html#cb13-43" tabindex="-1"></a><span class="fu">sum</span>(cl<span class="sc">$</span>size)</span>
<span id="cb13-44"><a href="bulk.html#cb13-44" tabindex="-1"></a></span>
<span id="cb13-45"><a href="bulk.html#cb13-45" tabindex="-1"></a>gene2cluster <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">gene=</span><span class="fu">names</span>(cl<span class="sc">$</span>cluster),<span class="at">cluster=</span>cl<span class="sc">$</span>cluster)</span>
<span id="cb13-46"><a href="bulk.html#cb13-46" tabindex="-1"></a></span>
<span id="cb13-47"><a href="bulk.html#cb13-47" tabindex="-1"></a><span class="fu">head</span>(cl<span class="sc">$</span>membership)</span>
<span id="cb13-48"><a href="bulk.html#cb13-48" tabindex="-1"></a>O <span class="ot">&lt;-</span> <span class="fu">overlap</span>(cl)</span>
<span id="cb13-49"><a href="bulk.html#cb13-49" tabindex="-1"></a>Ptmp <span class="ot">&lt;-</span>  <span class="fu">overlap.plot</span>(cl,<span class="at">over=</span>O,<span class="at">thres=</span><span class="fl">0.05</span>)</span>
<span id="cb13-50"><a href="bulk.html#cb13-50" tabindex="-1"></a></span>
<span id="cb13-51"><a href="bulk.html#cb13-51" tabindex="-1"></a></span>
<span id="cb13-52"><a href="bulk.html#cb13-52" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb13-53"><a href="bulk.html#cb13-53" tabindex="-1"></a><span class="fu">library</span>(Mfuzz)</span>
<span id="cb13-54"><a href="bulk.html#cb13-54" tabindex="-1"></a>color<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#ff0000&quot;</span>, <span class="st">&quot;Yellow&quot;</span>, <span class="st">&quot;OliveDrab1&quot;</span>)))(<span class="dv">1000</span>)</span>
<span id="cb13-55"><a href="bulk.html#cb13-55" tabindex="-1"></a></span>
<span id="cb13-56"><a href="bulk.html#cb13-56" tabindex="-1"></a><span class="fu">mfuzz.plot2</span>(eset,cl,<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>),<span class="at">new.window=</span> <span class="cn">FALSE</span>,<span class="at">centre =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-57"><a href="bulk.html#cb13-57" tabindex="-1"></a>            <span class="at">time.labels=</span><span class="fu">colnames</span>(DEGs_exp_averp),<span class="at">colo =</span> color<span class="fl">.2</span>)</span></code></pre></div>
</div>
<div id="gsea" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> GSEA<a href="bulk.html#gsea" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="bulk.html#cb14-1" tabindex="-1"></a>clus.logfc <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co">#log2fc</span></span>
<span id="cb14-2"><a href="bulk.html#cb14-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb14-3"><a href="bulk.html#cb14-3" tabindex="-1"></a>  clus.logfc[[i]]<span class="ot">&lt;-</span> deg[[i]]<span class="sc">$</span>log2FoldChange</span>
<span id="cb14-4"><a href="bulk.html#cb14-4" tabindex="-1"></a>  <span class="fu">names</span>(clus.logfc[[i]]) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(deg[[i]])</span>
<span id="cb14-5"><a href="bulk.html#cb14-5" tabindex="-1"></a>  <span class="fu">names</span>(clus.logfc)[i] <span class="ot">&lt;-</span> <span class="fu">names</span>(deg)[i]</span>
<span id="cb14-6"><a href="bulk.html#cb14-6" tabindex="-1"></a>}</span>
<span id="cb14-7"><a href="bulk.html#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="bulk.html#cb14-8" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb14-9"><a href="bulk.html#cb14-9" tabindex="-1"></a>geneList <span class="ot">&lt;-</span> clus.logfc[[i]]</span>
<span id="cb14-10"><a href="bulk.html#cb14-10" tabindex="-1"></a>geneList <span class="ot">&lt;-</span> <span class="fu">sort</span>(geneList, <span class="at">decreasing =</span> T)</span>
<span id="cb14-11"><a href="bulk.html#cb14-11" tabindex="-1"></a>egmt <span class="ot">&lt;-</span> <span class="fu">GSEA</span>(geneList, <span class="at">TERM2GENE=</span>geneset, <span class="at">verbose=</span>T,<span class="at">pvalueCutoff =</span> <span class="dv">1</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cytokine-profiles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="scrna-seq.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/02-Bulk.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MM-CAR-T.pdf", "MM-CAR-T.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
